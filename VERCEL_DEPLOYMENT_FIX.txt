╔══════════════════════════════════════════════════════════════════╗
║                                                                  ║
║          🔧 FIX VERCEL DEPLOYMENT - ERROR 401 🔧                 ║
║                                                                  ║
║           Perbaikan untuk https://rfs-store.vercel.app/          ║
║                                                                  ║
╚══════════════════════════════════════════════════════════════════╝

═══════════════════════════════════════════════════════════════════
🚨 MASALAH YANG TERJADI
═══════════════════════════════════════════════════════════════════

ERROR:
lzuqfckzboeqwtlqjfgm.supabase.co/rest/v1/profiles:1   
Failed to load resource: the server responded with a status of 401 ()

PENYEBAB:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1. ❌ Database schema belum di-run di Supabase
2. ❌ Table profiles tidak ada atau RLS policies salah
3. ❌ Environment variables belum di-set di Vercel
4. ❌ Missing INSERT policy untuk profiles table

═══════════════════════════════════════════════════════════════════
✅ SOLUSI - STEP BY STEP
═══════════════════════════════════════════════════════════════════

⚠️ IKUTI URUTAN INI DENGAN TELITI! ⚠️

═══════════════════════════════════════════════════════════════════
STEP 1: RUN DATABASE SCHEMA DI SUPABASE
═══════════════════════════════════════════════════════════════════

1.1 LOGIN KE SUPABASE
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Visit: https://supabase.com/dashboard/project/lzuqfckzboeqwtlqjfgm

1.2 OPEN SQL EDITOR
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
- Click "SQL Editor" di sidebar kiri
- Atau visit: 
  https://supabase.com/dashboard/project/lzuqfckzboeqwtlqjfgm/sql

1.3 CREATE NEW QUERY
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
- Click "+ New Query" button

1.4 COPY SCHEMA FILE
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⚠️ IMPORTANT: Use the FIXED version!

File to copy: supabase-schema-fixed.sql

This file includes:
✅ Fixed INSERT policy for profiles
✅ Automatic profile creation trigger
✅ IF NOT EXISTS clauses (safe to rerun)
✅ DROP policies before recreate
✅ Sample services data

1.5 PASTE & RUN
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
- Paste entire content dari supabase-schema-fixed.sql
- Click "Run" button (or press Ctrl + Enter)
- Wait for execution (~10-15 seconds)
- Check for success message

1.6 VERIFY TABLES CREATED
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Go to "Table Editor" and verify these tables exist:
✅ profiles
✅ services
✅ orders
✅ invoices
✅ payment_proofs
✅ notifications
✅ audit_logs

═══════════════════════════════════════════════════════════════════
STEP 2: VERIFY SUPABASE AUTHENTICATION SETTINGS
═══════════════════════════════════════════════════════════════════

2.1 GO TO AUTHENTICATION
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Visit: https://supabase.com/dashboard/project/lzuqfckzboeqwtlqjfgm/auth/providers

2.2 CHECK EMAIL PROVIDER
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Ensure these settings:
✅ Email provider: ENABLED
✅ Enable email sign-up: YES
✅ Email confirmations: OFF (for testing) or ON (for production)

2.3 CONFIGURE SITE URL
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Go to: Auth → URL Configuration

Site URL: https://rfs-store.vercel.app

Redirect URLs (add both):
- https://rfs-store.vercel.app
- https://rfs-store.vercel.app/**

Click "Save"

═══════════════════════════════════════════════════════════════════
STEP 3: SETUP ENVIRONMENT VARIABLES DI VERCEL
═══════════════════════════════════════════════════════════════════

3.1 LOGIN TO VERCEL
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Visit: https://vercel.com/jonalexanderhere/rfs-store/settings/environment-variables

3.2 ADD ENVIRONMENT VARIABLES
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Click "Add New" untuk setiap variable ini:

REQUIRED VARIABLES:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Name: VITE_SUPABASE_URL
Value: https://lzuqfckzboeqwtlqjfgm.supabase.co
Environments: Production, Preview, Development

Name: VITE_SUPABASE_ANON_KEY
Value: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx6dXFmY2t6Ym9lcXd0bHFqZmdtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEyMTQ0OTYsImV4cCI6MjA3Njc5MDQ5Nn0.Zjy_gk4c2dgXNW_EUOY-J4Vk3-VCxaL8W8D70WgQmjk
Environments: Production, Preview, Development

OPTIONAL (for advanced features):
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Name: VITE_TELEGRAM_BOT_TOKEN
Value: 8464163003:AAHLj8X0p7dY2_mHH7y8GH02uXU--B8fXXM
Environments: Production, Preview, Development

Name: VITE_FONNTE_TOKEN
Value: hakuNNT3TBPHvGqtcF2QYLXnFaUYQt66Qsg91ndi6
Environments: Production, Preview, Development

Name: VITE_APP_URL
Value: https://rfs-store.vercel.app
Environments: Production, Preview, Development

⚠️ IMPORTANT:
- Make sure variable names start with VITE_ (Vite requirement)
- Select ALL three environments for each variable
- Click "Save" after each variable

═══════════════════════════════════════════════════════════════════
STEP 4: REDEPLOY VERCEL
═══════════════════════════════════════════════════════════════════

4.1 GO TO DEPLOYMENTS
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Visit: https://vercel.com/jonalexanderhere/rfs-store

4.2 TRIGGER REDEPLOY
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Option A - From Vercel Dashboard:
1. Click on latest deployment
2. Click "..." (three dots)
3. Click "Redeploy"
4. Confirm "Redeploy"

Option B - Push to GitHub:
1. Make any small change (add comment to README)
2. git add .
3. git commit -m "trigger redeploy"
4. git push
5. Vercel will auto-deploy

4.3 WAIT FOR DEPLOYMENT
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
- Wait ~2-5 minutes
- Check deployment status in Vercel dashboard
- Look for "Ready" status

═══════════════════════════════════════════════════════════════════
STEP 5: TEST DEPLOYED APPLICATION
═══════════════════════════════════════════════════════════════════

5.1 VISIT WEBSITE
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Visit: https://rfs-store.vercel.app/

5.2 CHECK HOMEPAGE
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
You should see:
✅ Clean professional design
✅ Header with "RFS STORE" logo
✅ Hero section loaded
✅ No 401 errors in console (F12)
✅ Services displayed

5.3 TEST REGISTRATION
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1. Click "Daftar" button
2. Fill registration form:
   - Full Name: Test User
   - Email: test@example.com
   - Phone: 08123456789
   - Password: test123
   - Confirm Password: test123
3. Click "Daftar Sekarang"
4. Should see success message
5. Check Supabase → Table Editor → profiles
6. Your user should appear there!

5.4 TEST LOGIN
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1. Click "Login" button
2. Enter credentials:
   - Email: test@example.com
   - Password: test123
3. Click "Login ke Dashboard"
4. Should redirect to dashboard
5. Dashboard should load without errors

5.5 CHECK BROWSER CONSOLE
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Press F12 → Console tab
Should see NO red errors!

If you see errors, take screenshot and send to me.

═══════════════════════════════════════════════════════════════════
🔍 TROUBLESHOOTING
═══════════════════════════════════════════════════════════════════

PROBLEM 1: Still getting 401 error
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
SOLUTION:
1. Verify supabase-schema-fixed.sql was run successfully
2. Check Table Editor → profiles table exists
3. Check RLS is enabled on profiles table
4. Run this query in SQL Editor:
   
   SELECT * FROM pg_policies WHERE tablename = 'profiles';
   
   Should show 3 policies:
   - Public profiles are viewable by everyone
   - Users can insert own profile on signup
   - Users can update own profile

PROBLEM 2: Environment variables not loading
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
SOLUTION:
1. Go to Vercel → Settings → Environment Variables
2. Verify ALL variables have "Production" checked
3. Redeploy after adding variables
4. Clear Vercel build cache: 
   Deployments → ... → "Clear Cache and Redeploy"

PROBLEM 3: Registration fails
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
SOLUTION:
1. Check Auth → URL Configuration:
   - Site URL = https://rfs-store.vercel.app
   - Redirect URLs includes your domain
2. Verify trigger exists:
   
   SELECT * FROM pg_trigger WHERE tgname = 'on_auth_user_created';
   
3. If trigger missing, rerun supabase-schema-fixed.sql

PROBLEM 4: Services not showing
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
SOLUTION:
1. Check Table Editor → services table
2. If empty, run this in SQL Editor:
   
   INSERT INTO public.services (name, description, icon, category) VALUES
   ('Jasa Pembuatan Tugas Kuliah', 'Bantuan tugas kuliah berkualitas', 'file-text', 'academic'),
   ('Rental Laptop', 'Sewa laptop untuk kuliah', 'laptop', 'rental'),
   ('Jasa Pembuatan Makalah', 'Makalah dengan referensi lengkap', 'book-open', 'academic');

PROBLEM 5: Page is blank
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
SOLUTION:
1. Hard refresh: Ctrl + Shift + R
2. Clear cache and hard reload
3. Check console for errors
4. Verify deployment completed successfully

═══════════════════════════════════════════════════════════════════
✅ VERIFICATION CHECKLIST
═══════════════════════════════════════════════════════════════════

Database Setup:
[ ] Supabase SQL Editor opened
[ ] supabase-schema-fixed.sql executed
[ ] All 7 tables created
[ ] RLS policies active
[ ] Trigger created
[ ] Sample services inserted

Supabase Auth:
[ ] Email provider enabled
[ ] Site URL configured
[ ] Redirect URLs added

Vercel Environment:
[ ] VITE_SUPABASE_URL added
[ ] VITE_SUPABASE_ANON_KEY added
[ ] All variables in Production
[ ] Project redeployed

Testing:
[ ] Homepage loads without errors
[ ] No 401 errors in console
[ ] Registration works
[ ] Login works
[ ] Dashboard accessible
[ ] Services visible

═══════════════════════════════════════════════════════════════════
📊 EXPECTED RESULTS AFTER FIX
═══════════════════════════════════════════════════════════════════

BEFORE (Error):
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
❌ https://rfs-store.vercel.app/ shows blank page
❌ Console shows: 401 Failed to load resource
❌ Cannot access profiles endpoint
❌ Registration fails
❌ Login fails

AFTER (Fixed):
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ https://rfs-store.vercel.app/ loads completely
✅ Homepage shows professional design
✅ No errors in console
✅ Services displayed
✅ Registration works smoothly
✅ Login successful
✅ Dashboard loads with data
✅ All pages accessible

═══════════════════════════════════════════════════════════════════
🎯 SUMMARY
═══════════════════════════════════════════════════════════════════

Issue: Error 401 on /rest/v1/profiles endpoint

Root Cause:
1. Database schema not deployed
2. Missing INSERT policy for profiles
3. Environment variables not configured in Vercel

Solution:
1. ✅ Run supabase-schema-fixed.sql in Supabase
2. ✅ Add environment variables in Vercel
3. ✅ Redeploy Vercel project
4. ✅ Test registration and login

Files Created:
📄 supabase-schema-fixed.sql - Fixed database schema
📄 This file - Deployment fix guide

═══════════════════════════════════════════════════════════════════
📞 NEED HELP?
═══════════════════════════════════════════════════════════════════

If you encounter any issues:
1. Take screenshot of:
   - Vercel deployment log
   - Browser console (F12 → Console)
   - Supabase SQL Editor result
2. Note exact error message
3. Send to me for analysis

═══════════════════════════════════════════════════════════════════
🎉 GOOD LUCK!
═══════════════════════════════════════════════════════════════════

Follow these steps carefully and your Vercel deployment will work!

Your website will be live at: https://rfs-store.vercel.app/

After fixing, it should be fully functional with:
✅ Professional modern design
✅ User registration & login
✅ Dashboard access
✅ Services management
✅ No 401 errors!

═══════════════════════════════════════════════════════════════════

Created: $(Get-Date -Format "yyyy-MM-dd HH:mm:ss")
Status: READY TO FIX
Action Required: Follow steps above

═══════════════════════════════════════════════════════════════════

